{% extends "admin_layout.html" %}
{% block content %}

<!-- flash messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
{% for category, message in messages %}
<div class="alert alert-{{ category }} text-center" role="alert">
    <h5><b>{{ message }}</b></h5>
</div>
{% endfor %}
{% endif %}
{% endwith %}
<!-- Page Title -->
<h1 class="center m-4">Welcome, {{user.fullname}} ! </h1>
<div class="section-title">Parking Lots</div>
<!-- Parking Lot Cards -->
<div class="d-flex flex-wrap justify-content-start gap-2">
    {% if parkinglots %}
    {% for parkinglot in parkinglots %}
    <div class="parking-lot bg-light ">
        <div class="lot-title">{{ parkinglot.prime_location_name }}</div>
        <div class="lot-subtitle mb-3">{{ parkinglot.address }}</div>
        <div class="fw-bold mb-1">Available Spots: <span class="badge bg-success">{{ parkinglot.available_count}}</span></div>
        <div class="fw-bold mb-4">Occupied Spots: <span class="badge bg-danger"> {{ parkinglot.occupied_count }}</span>
        </div>
        <div>
            <a href="{{ url_for('update_parkinglot', id=parkinglot.id, email=email) }}"
                class="btn btn-warning rounded-pill">Update</a>
            <form action="{{ url_for('delete_parkinglot', id=parkinglot.id, email=email) }}" method="POST"
                class="d-inline"
                onsubmit="return confirm('Are you sure you want to delete this parking lot? This action cannot be undone.');">
                <button type="submit" class="btn btn-danger rounded-pill">Delete</button>
            </form>
        </div>
        <hr>
        <!-- Spot Grid -->
        {% if parkinglot.parkingspot %} <!-- accessing parkingspot from parkinglot by relationship in db -->
        <div class="spot-grid mb-3">
            {% for spot in parkinglot.parkingspot %}
            <a href="{{ url_for('view_parkingspot', spot_id=spot.id, email=user.email ) }}"
                style="text-decoration: none;">
                <div class="spot-box {% if spot.status == 'A' %}available{% else %}occupied{% endif %}">
                    {{ spot.status }}
                </div>
            </a>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-danger text-center "><b>No spots available!</b></p>
        {% endif %}
    </div>
    {% endfor %}
    {% else %}
    <div class="w-100 text-center mt-5">
        <h4 class="text-danger">No parking lots found!</h4>
    </div>
    {% endif %}
</div>
{% if not is_search %} <!--when no_search is false display the code below-->
<!-- Add Lot Button -->
<div class=" text-center mt-5">
    <a href="{{ url_for('add_parking_lot', email=email) }}" class="btn btn-outline-success">+Add Parking Lot</a>
</div>
{% endif %}
{% endblock %}